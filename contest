<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.26/jquery.form-validator.min.js"></script>
<div class="main_banner text-center">
    <h3>Contest</h3>
    <p>explore • enjoy • shop</p>
</div>
<div class="store_list_head main_container">
    <div class="row hidden_phone">
        <div class="col-md-12">
            <h5 class="active_heading">CONTEST</h5>
        </div>
    </div>
</div>
 <div class="content_container main_container">
    <div class="margin_25_across">
        <div class="row">
            <div class="col-md-12">
                <div id="succes_msg" class="hidden_now alert alert-success" role="alert" v-show="formSuccess">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    <span class="sr-only">Success</span>
                    Thank you! Your entry has been received.
                </div>
                <div id="error_msg" class="hidden_now alert alert-danger" role="alert" v-show="formError">
                    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                    <span class="sr-only">Error:</span>
                    There was an error when trying to submit your request. Please try again later.
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="" id="contest_container">
                    <script id="contest_template" type="x-tmpl-mustache">
                        <div class="promo-details">
                            <div class="event-image">
                                <img class="contest banner" src="{{image_url}}">
                            </div>
                            <br>
                            <div class="event-description">
                                {{{ rich_description }}}
                            </div>
                            <br>
                        </div> 
                        <form id="contest_form">
                            <label for="propert_id" style="display:none">Property ID</label>
                            <input id="propert_id" name="json[property_id]" style="display:none" value="{{property_id}}" />
                            <label for="contest_id" style="display:none">Contest ID</label>
                            <input id="contest_id" name="json[contest_id]" style="display:none" value="{{id}}" />
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="first_name">First Name *</label>  
                                    <input class="form-control margin_30" id="first_name" name="json[first_name]" type="text" required data-validation="required" tabindex="1"/>
                                </div>
                                <div class="col-md-6">
                                    <label for="last_name">Last Name *</label>  
                                    <input class="form-control margin_30" id="last_name" name="json[last_name]" type="text" required data-validation="required" tabindex="2"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">    
                                    <label for="email">Email *</label> 
                                    <input class="form-control margin_30" id="email" name="json[email]" type="email" required data-validation-regexp="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$" data-validation-error-msg="Please enter a valid email address" data-validation="custom" tabindex="3"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="postal_code">Postal Code</label>  
                                    <input class="form-control margin_30" id="postal_code" name="json[postal_code]" type="text" tabindex="4"/>    
                                </div>
                                <div class="col-md-4">
                                    <label for="phone">Phone Number</label>  
                                    <input class="form-control margin_30" id="phone" name="json[phone]" type="text" tabindex="5"/>
                                </div>
                                <div class="col-md-4">
                                    <label for="age">Age</label>
                                    <select class="form-control margin_30" id="age" name="json[age]" tabindex="6">
                                        <option selected disabled>Select Your Age Range</option>
                                        <option value="0 to 18">0 - 18</option>
                                        <option value="19-25">19 - 25</option>
                                        <option value="26-35">26 - 35</option>
                                        <option value="36-45">36 - 45</option>
                                        <option value="46-55">46 - 55</option>
                                        <option value="56-65">56 - 65</option>
                                        <option value="65+">65+</option>
                                    </select>
                                    <input  id="selected_age" name="json[age]" type="text" />
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-12">
                                    <label class="agree">
                                        <input id="newsletter_signup" type="checkbox" name="json[newsletter]" tabindex="7"/> 
                                        Yes, I would like to receive ongoing communications from Carlingwood Mall.
                                    </label>
                                    <br/><br/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <label class="agree">
                                        <input id="contest_rules" type="checkbox" name="" required tabindex="8"/> 
                                        Yes, I have read and agree to the contest rules.
                                    </label>
                                    <br/><br/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <a href="/pages/carlingwood-contest-rules-regulations" target="_blank" tabindex="9">
                                        View the Contest Rules & Regulations
                                    </a>
                                    <br/><br/>
                                    <button class="contest_btn animated_btn newsletter_btn" tabindex="10">Submit</button>
                                    <br/><br/>
                                    <br/><br/>
                                </div>
                            </div>
                        </form>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function(e) {
        init(e);
        function renderPageData(){
            var contests = getContestList();
            var current_contest = [];
            $.each(contests, function(key, val){
                if(val.show_on_slug === "carlingwood-contest") {
                    current_contest.push(val);
                } 
            });
            var slug = current_contest[0].slug;

            renderContest("#contest_container", '#contest_template', current_contest);

            show_content();

            $.validate();
            
            $("#age").bind("change", function(e) {
                e.preventDefault()
                var selected = $("#age option:selected")
                selected = selected[0]
                var selectedRange = $(selected).val();
                console.log(selectedRange)
                $("#selected_age").val(selectedRange)
                // var href = "/posts?category=" + selectedCat
                // document.location.href = href;
            });
            
            $('#contest_form').submit(function(e){
                e.preventDefault();
                $('.contest_btn').prop('disabled', true);
                submit_contest(slug);
                $('html, body').animate({scrollTop : 0},800);
            });
        }
        
        loadMallDataCached(renderPageData);
        
        function submit_contest(slug) {
            // var contest_entry = {};
            // var contest_data = {};
            // contest_data.first_name = $('#first_name').val();
            // contest_data.last_name = $('#last_name').val();
            // contest_data.postal_code = $('#postal_code').val();
            // contest_data.phone = $('#phone').val();
            // // var age = $('#age').val().toString();
            // contest_data.age = $("#selected_age").val();
            // contest_data.email = $('#email').val();
            // contest_data.newsletter = $('#newsletter_signup').prop("checked");
            // console.log("contest_data", contest_data)
            // contest_entry.contest = contest_data;
            // console.log("contest_entry", contest_entry)
            // var propertyDetails = getPropertyDetails();
            // var host = propertyDetails.mm_host.replace("http:", "");
            // var action = host + "/contests/" + slug + "/create_js_entry"
            // $.ajax({
            //     url : action,
            //     type: "POST",
            //     data : contest_entry,
            //     success: function(data){
            //       $('#succes_msg').show();
            //       $('.contest_btn').prop('disabled', false);
            //       $('#contest_form').trigger('reset');
            //     },
            //     error: function (data){
            //         alert('An error occured while processing your request. Please try again later!')
            //         $('#error_msg').show();
            //     }
            // });
            
            $('#contest_form').submit(function(e) {
                e.preventDefault();
                var formData = new FormData($(this)[0]);
                console.log("formData", formData)
                var action = host + "/contests/" + slug + "/json_entry"
                $.ajax({
                    url: action,
                    // cache: false,
                    type: 'POST',
                    data : formData,
                    // processData: false,
                    // contentType: false,
                    success: function(data){
                        $('#succes_msg').show();
                        $('.contest_btn').prop('disabled', false);
                        $('#contest_form').trigger('reset');
                    },
                    error: function (data){
                        alert('An error occured while processing your request. Please try again later!')
                        $('#error_msg').show();
                    }
                });
            });
        }
    });
</script>