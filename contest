<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.26/jquery.form-validator.min.js"></script>
<div class="contest_banner text-center">
    <div class="contest_banner_container">
        <h3>Contest</h3>
        <p>explore • enjoy • shop</p>
    </div>
</div>
<div class="margin_30"></div>
<div class="content_container main_container">
    <div class="margin_25_across">
        <div class="row">
            <div class="col-md-12">
                <div id="succes_msg" class="hidden_now alert alert-success" role="alert" v-show="formSuccess">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    <span class="sr-only">Success</span>
                    Thank you! Your entry has been received.
                </div>
                <div id="error_msg" class="hidden_now alert alert-danger" role="alert" v-show="formError">
                    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                    <span class="sr-only">Error:</span>
                    There was an error when trying to submit your request. Please try again later.
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="" id="contest_container">
                    <script id="contest_template" type="x-tmpl-mustache">
                        <div class="promo-details">
                            <div class="event-image">
                                <img class="contest banner" src="{{image_url}}">
                            </div>
                            <br>
                            <div class="contest_description">
                                {{{ rich_description }}}
                            </div>
                            <br>
                        </div> 
                        <form id="contest_form" action="https://mobilefringe.createsend.com/t/d/s/yujthl/">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="first_name">First Name *</label>  
                                    <input class="form-control margin_30" id="first_name" name="First Name" type="text" required data-validation="required" tabindex="1"/>
                                </div>
                                <div class="col-md-6">
                                    <label for="last_name">Last Name *</label>  
                                    <input class="form-control margin_30" id="last_name" name="Last Name" type="text" required data-validation="required" tabindex="2"/>
                                    <input class="hidden_now" id="fieldName" name="cm-name" type="text" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">    
                                    <label for="fieldEmail">Email *</label> 
                                    <input class="form-control margin_30" id="fieldEmail" name="cm-yujthl-yujthl" type="email" required data-validation-regexp="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$" data-validation-error-msg="Please enter a valid email address" data-validation="custom" tabindex="3"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="postal_code">Postal Code</label>  
                                    <input class="form-control margin_30" id="postal_code" name="Postal Code" type="text" tabindex="4"/>    
                                </div>
                                <div class="col-md-4">
                                    <label for="phone">Phone Number</label>  
                                    <input class="form-control margin_30" id="phone" name="Phone Number" type="text" tabindex="5"/>
                                </div>
                                <div class="col-md-4">
                                    <label for="age">Age</label>
                                    <select class="form-control margin_30" id="age" tabindex="6">
                                        <option selected disabled>Select Your Age Range</option>
                                        <option value="0 to 18">0 - 18</option>
                                        <option value="19-25">19 - 25</option>
                                        <option value="26-35">26 - 35</option>
                                        <option value="36-45">36 - 45</option>
                                        <option value="46-55">46 - 55</option>
                                        <option value="56-65">56 - 65</option>
                                        <option value="65+">65+</option>
                                    </select>
                                    <input class="hidden_now" id="selected_age" name="Age Range" type="text" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <label class="agree">
                                        <input id="newsletter_signup" type="checkbox" name="Subscribe to Newsletter" tabindex="7"/> 
                                        Yes, I would like to receive ongoing communications from Carlingwood Mall.
                                    </label>
                                    <br/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <label class="agree">
                                        <input id="contest_rules" type="checkbox" name="" required tabindex="8"/> 
                                        Yes, I have read and agree to the <a href="/pages/carlingwood-contest-rules-regulations" target="_blank">Contest Rules</a>.
                                    </label>
                                    <br/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <button class="contest_btn animated_btn newsletter_btn" tabindex="10">Submit</button>
                                    <br/>
                                </div>
                            </div>
                        </form>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function(e) {
        init(e);
        function renderPageData(){
            var contests = getContestList();
            var current_contest = [];
            $.each(contests, function(key, val){
                if(val.show_on_slug === "carlingwood-contest") {
                    current_contest.push(val);
                } 
            });
            var slug = current_contest[0].slug;

            renderContest("#contest_container", '#contest_template', current_contest);

            show_content();

            $.validate();

            $("#age").bind("change", function(e) {
                e.preventDefault()
                var selected = $("#age option:selected")
                selected = selected[0]
                var selectedRange = $(selected).val();
                $("#selected_age").val(selectedRange);
            });
            
            $('#contest_form').submit(function(e){
                e.preventDefault();
                $('.contest_btn').prop('disabled', true);
                submit_contest(slug, e);
            });
        }
        
        loadMallDataCached(renderPageData);

        function submit_contest(slug, e) {
            var first_name = $("#first_name").val();
            var last_name = $("#last_name").val();
            $("#fieldName").val(first_name +" " + last_name);
            var tempData = {};
            tempData["First Name"] = $("#first_name").val();
            tempData["Last Name"] = $("#last_name").val();
            tempData["Email Address"] = $("#fieldEmail").val();
            tempData["Postal Code"] = $("#postal_code").val();
            tempData["Phone Number"] = $("#phone").val();
            tempData["Age Range"] = $("#selected_age").val();
            var newsletter = "";
            if ($("#newsletter_signup").is(':checked')) {
              newsletter = "Yes!";
            } else {
              newsletter = "No";
            }
            tempData["Subscribed to Newsletter"] = newsletter
            var postData = {};
            postData.json = JSON.stringify(tempData);
            var propertyDetails = getPropertyDetails();
            var host = propertyDetails.mm_host.replace("http:", "");
            var action = host + "/contests/" + slug + "/json_entry"
            $.post(action, postData, function(data){
                if(data.message == "success"){
                    if ($("#newsletter_signup").is(':checked')) {
                        e.target.submit();
                    }
                    $('#succes_msg').show();
                    $('.contest_btn').prop('disabled', false);
                    $('#contest_form').trigger('reset');
                    $('html, body').animate({scrollTop : 0},800);
                } else {
                    alert('An error occured while processing your request. Please try again later!')
                    $('#error_msg').show();
                }
            });
        }
    });
</script>